# Feature Specification: Улучшение создания персонажей WFRP

**Feature Branch**: `002-character-creation`  
**Created**: 2026-02-17  
**Status**: Draft  
**Input**: User description: "добавь требования к команде созадния нового персонажа: /character <имя> добавить вывод команды в help; На каждом этапе персонажа можно задавать вопрос к LLM; возможность "сгенери сам" для генерации имени; карточка персонажа по шаблону; характеристики на русском (ББ, ДБ); команда списка всех персонажей"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - Создание персонажа с именем (Priority: P1)

Game Master отправляет команду /character <имя> для начала создания персонажа. Бот инициирует процесс создания, запрашивая распределение характеристик.

**Why this priority**: Это базовая функция создания персонажа - без неё невозможна работа с персонажами.

**Independent Test**: Тестируется отправкой команды /character ТестПерсонаж и проверкой начала диалога создания.

**Acceptance Scenarios**:

1. **Given** бот запущен, **When** GM отправляет "/character Арнольд", **Then** бот начинает процесс создания персонажа с именем "Арнольд"
2. **Given** бот запущен, **When** GM отправляет "/character", **Then** бот выводит справку по использованию команды

---

### User Story 2 - Запрос пояснений у LLM (Priority: P1)

На любом этапе создания персонажа GM может задать вопрос LLM о правилах распределения характеристик, выбора профессии и т.д.

**Why this priority**: Позволяет GM получить квалифицированные пояснения по правилам WFRP без поиска в документации.

**Independent Test**: Тестируется отправкой вопроса "как распределить характеристики" в процессе создания и проверкой ответа от LLM.

**Acceptance Scenarios**:

1. **Given** процесс создания персонажа начат, **When** GM спрашивает "как распределить характеристики", **Then** бот делает запрос к LLM и выводит ответ согласно правилам WFRP
2. **Given** процесс создания персонажа начат, **When** GM спрашивает "что такое ББ", **Then** бот объясняет значение характеристик на русском

---

### User Story 3 - Автогенерация имени (Priority: P2)

GM может попросить бота самостоятельно сгенерировать имя персонажа с помощью LLM.

**Why this priority**: Упрощает и ускоряет процесс создания, особенно для второстепенных персонажей.

**Independent Test**: Тестируется отправкой "сгенери имя" и проверкой сгенерированного имени.

**Acceptance Scenarios**:

1. **Given** процесс создания персонажа начат, **When** GM отправляет "сгенери имя" или "сгенери сам", **Then** бот генерирует имя персонажа через LLM и использует его

---

### User Story 4 - Карточка персонажа по шаблону (Priority: P1)

По завершении создания бот выводит полную карточку персонажа согласно шаблону: имя, характеристики (ББ, ДБ, СС, И, Л, О, СТ, К), навыки, профессия, описание.

**Why this priority**: Карточка - основной артефакт персонажа для игры.

**Independent Test**: Тестируется завершением создания персонажа и проверкой вывода карточки.

**Acceptance Scenarios**:

1. **Given** персонаж создан, **When** процесс завершён, **Then** бот выводит карточку с именем, всеми 8 характеристиками на русском, профессией, навыками

---

### User Story 5 - Характеристики на русском языке (Priority: P1)

Все характеристики выводятся на русском: Боевая Пригодность (ББ), Дистанция Боя (ДБ), Сила (СС), Интеллект (И), Лучезарность (Л), Общение (О), Стойкость (СТ), Классовая (К).

**Why this priority**: Основное требование для игры на русском языке.

**Independent Test**: Тестируется созданием персонажа и проверкой названий характеристик.

**Acceptance Scenarios**:

1. **Given** персонаж создан, **When** выводится карточка, **Then** характеристики отображаются как "ББ: X, ДБ: Y, СС: Z, И: W, Л: V, О: U, СТ: T, К: S"

---

### User Story 6 - Список всех персонажей (Priority: P2)

GM может получить список всех созданных персонажей одной командой.

**Why this priority**: Позволяет быстро просмотреть всех персонажей кампании.

**Independent Test**: Тестируется отправкой команды /characters и проверкой списка.

**Acceptance Scenarios**:

1. **Given** в кампании есть персонажи, **When** GM отправляет "/characters", **Then** бот выводит нумерованный список всех персонажей с краткой информацией (имя, профессия)
2. **Given** в кампании нет персонажей, **When** GM отправляет "/characters", **Then** бот сообщает что персонажей не найдено

---

### Edge Cases

- Что происходит, если персонаж с таким именем уже существует?
- Как обрабатывается отмена создания персонажа?
- Что если LLM недоступен при запросе пояснений?

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: Бот ДОЛЖЕН выводить справку по команде /character при вызове без аргументов
- **FR-002**: Бот ДОЛЖЕН поддерживать возможность задать вопрос LLM на любом этапе создания персонажа
- **FR-003**: Бот ДОЛЖЕН генерировать имя персонажа через LLM по команде "сгенери имя" или "сгенери сам"
- **FR-004**: Бот ДОЛЖЕН выводить полную карточку персонажа по завершении создания
- **FR-005**: Бот ДОЛЖЕН использовать русские названия характеристик: ББ, ДБ, СС, И, Л, О, СТ, К
- **FR-006**: Бот ДОЛЖЕН выводить список всех персонажей по команде /characters
- **FR-007**: Бот ДОЛЖЕН проверять уникальность имени персонажа при создании
- **FR-008**: Бот ДОЛЖЕН обрабатывать ошибки LLM с понятным сообщением пользователю

### Key Entities

- **Персонаж**: Имя, 8 характеристик (ББ, ДБ, СС, И, Л, О, СТ, К), профессия, навыки, описание
- **Кампания**: Набор персонажей, принадлежащих одному Game Master
- **Шаблон карточки**: Структурированный вывод информации о персонаже

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: GM может создать персонажа одной командой /character Имя затратив не более 5 минут
- **SC-002**: 100% вопросов о правилах WFRP в процессе создания получают корректный ответ от LLM
- **SC-003**: Все созданные персонажи отображаются в списке /characters с корректными данными
- **SC-004**: Карточка персонажа содержит все 8 характеристик на русском языке
- **SC-005**: Команда /character без аргументов выводит справку
