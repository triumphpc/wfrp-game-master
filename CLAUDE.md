# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Обзор проекта

Это проект для ведения настольной ролевой игры **Warhammer Fantasy Roleplay 4e (WFRP 4e)**. Проект содержит все необходимые материалы для Мастера игры: правила, персонажей, историю сессий и промты для ИИ-мастера.

## Структура проекта

```
wfrp-game-master/
├── characters/           # Профили персонажей игроков
│   ├── character_1_feliran.md
│   ├── character_2_kurt_stahler.md
│   ├── character_3_dietrich_russel.md
│   ├── character_4_thorgrim_ironbeard.md
│   └── party_summary.md  # Сводка по партии
├── history/             # История игровых сессий
│   ├── 2026-01-17_17-54_game_start.md
│   ├── 2026-01-18_08-52_rules_update.md
│   └── ... (файлы по датам и времени)
├── wfrp_rulebook.md     # Основные правила WFRP 4e (2.1MB)
├── game_master_prompt.md # Промт для ИИ-мастера игры
├── Ширма.txt            # Быстрые таблицы и справочник мастера
├── Рассказ. Властелины болота.docx.txt # Сценарий приключения
├── character_image_prompts.md # Промты для генерации изображений персонажей
└── Warhammer_Fantasy_RolePlay_4_redaktsia.pdf # PDF с правилами
```

## Ключевые файлы

### 1. Правила и промты
- **`wfrp_rulebook.md`** (2.1MB) - полные правила WFRP 4e на русском языке
- **`game_master_prompt.md`** - основной промт для ИИ-мастера с инструкциями по ведению игры
- **`Ширма.txt`** - быстрые таблицы сложности, модификаторы, справочные материалы

### 2. Персонажи
- **`characters/party_summary.md`** - сводная таблица характеристик всей партии
- **`characters/character_*.md`** - детальные профили каждого персонажа с:
  - Основными характеристиками (WS, BS, S, T, I, Ag, Dex, Int, WP, Fel)
  - Вторичными характеристиками (Раны, Судьба, Удача, Несгибаемость, Решимость)
  - Навыками, талантами, снаряжением
  - Предысторией и мотивацией

### 3. История игры
- **`history/`** - хронологические записи игровых сессий
- Формат имен файлов: `YYYY-MM-DD_HH-MM_description.md`
- Каждый файл содержит полную запись раунда или события

## Работа с ИИ-мастером

### Основные инструкции для мастера
1. **Перед началом игры** - запросить полные характеристики всех персонажей
2. **Проверки** - использовать только для значимых и рискованных действий
3. **Бои** - соблюдать баланс (не более 3 противников на игрока)
4. **Атмосфера** - создавать мрачный реализм Старого Света
5. **Социальные сцены** - давать время на ролевую игру и диалоги

### Критически важные правила
- **Частота проверок**: каждые 3-5 действий, не чаще
- **Баланс боёв**: максимум 3 противника на одного игрока
- **Темп игры**: не форсировать события, давать время на социальные взаимодействия
- **Мрачный реализм**: детальные описания, жестокость, грубая речь (18+)

### Формат ответов мастера
```
[Описание окружения, атмосферы, NPC]

Проверка: [Название навыка/характеристики]
Сложность: [Уровень сложности и модификатор]
Результат: [Опиши результат броска]

Раунд [номер]
Инициатива: [порядок действий]
[Описание действий по очереди]
```

## Текущее состояние игры

### Партия (4 персонажа):
1. **Фелиран** - Лесной эльф, Охотник (Ранг 1)
2. **Курт Шталер** - Человек, Шарлатан (Ранг 1)
3. **Дитрих Руссель** - Человек, Огненный маг (Ранг 1)
4. **Торгрим Железнобород** - Дварф, Воин (Ранг 1)

### Последняя сессия:
- **Сценарий**: "Властелины болота"
- **Локация**: Торговая баржа "Удача Мананна", река Рейк
- **Статус**: Партия выжила, Властелины отступили, пираты сбежали
- **Состояние персонажей**:
  - Фелиран: 13/13 HP, лук сломан
  - Курт: 13/18 HP, ранен
  - Дитрих: 6/15 HP, ранен, мокрый, возмущён
  - Торгрим: 5/18 HP, критическое ранение, без сознания

## Работа с файлами

### При ведении игры:
1. **Перед действием** - проверять файлы персонажей в `characters/`
2. **После раунда** - сохранять историю в `history/` с timestamp
3. **При неясностях** - обращаться к `wfrp_rulebook.md`
4. **Для быстрых справок** - использовать `Ширма.txt`

### Формат сохранения истории:
```bash
history/YYYY-MM-DD_HH-MM_description.md
```

## Начало новой сессии

1. Запросить у игроков обновлённые характеристики персонажей
2. Проверить файлы персонажей в `characters/`
3. Прочитать последнюю запись из `history/` для понимания контекста
4. Использовать промт из `game_master_prompt.md`
5. Начать с описания текущей ситуации

## Важные напоминания

- **Кубики бросают игроки** - мастер только говорит что бросать
- **Всегда учитывать всех NPC** - если NPC появился в сцене, он не исчезает
- **Дружественные NPC активны** - они должны участвовать в событиях
- **Учитывать все модификаторы** - ситуационные штрафы, состояние, окружение
- **Сохранять последовательность** - читать историю последних 2-3 раундов перед действиями